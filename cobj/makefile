#############################################################################################################
# PARAMS ####################################################################################################
#############################################################################################################

NAME := cobj
INCS := -I$(DIR_INC)
DEPS := 

#############################################################################################################
# FILE LISTS ################################################################################################
#############################################################################################################

SRC_DEMOS := $(wildcard $(DIR_DEMOS)/*.c)
SRC_LIB   := $(wildcard $(DIR_SRC)/*.c)
OBJ_LIB   := $(patsubst $(DIR_SRC)/%.c,   $(DIR_OBJ)/%.o, $(SRC_LIB))
BIN_DEMOS := $(patsubst $(DIR_DEMOS)/%.c, $(DIR_BIN)/%,   $(SRC_DEMOS))

#############################################################################################################
# PUBLIC TARGETS ############################################################################################
#############################################################################################################

build: dir lib $(BIN_DEMOS)

install:
	install -d $(DIR_INSTALL_INC)
	install -d $(DIR_INSTALL_LIB)
	install $(DIR_INC)/*/* $(DIR_INSTALL_INC)
	install $(DIR_LIB)/*   $(DIR_INSTALL_LIB)

clean:
	rm -rf $(DIR_BUILD)

#############################################################################################################
# PRIVATE TARGETS ###########################################################################################
#############################################################################################################

dir:
	mkdir -p $(DIR_LIB) $(DIR_OBJ) $(DIR_BIN)

lib: $(OBJ_LIB)
	$(CC) $(LDFLAGS) -o $(DIR_LIB)/lib$(NAME).so $^ $(DEPS)

$(DIR_OBJ)/%.o: $(DIR_SRC)/%.c
	$(CC) $(CFLAGS) -fPIC -c $< -o $@ $(INCS)

$(DIR_BIN)%: $(DIR_DEMOS)/%.c
	$(CC) $(CFLAGS) $< -o $@ $(INCS) -L$(DIR_LIB) -l$(NAME) $(DEPS) -Wl,-rpath='$$ORIGIN'/../lib
