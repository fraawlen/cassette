#############################################################################################################
# DESTINATIONS ##############################################################################################
#############################################################################################################

DEST_HEADERS := /usr/include/derelict
DEST_LIBS    := /usr/lib
DEST_BUILD   := build

#############################################################################################################
# INTERNAL VARIABLES ########################################################################################
#############################################################################################################

DIR_SRC := src
DIR_INC := $(DEST_BUILD)/inc
DIR_LIB := $(DEST_BUILD)/lib
DIR_OBJ := $(DEST_BUILD)/obj

LIST_SRC := $(wildcard $(DIR_SRC)/*.c)
LIST_INC := $(wildcard $(DIR_SRC)/*.h)
LIST_OBJ := $(patsubst $(DIR_SRC)/%.c, $(DIR_OBJ)/%.o, $(LIST_SRC))

FLAGS := -std=c99 -pedantic -Wall -Wextra -O3 -D_POSIX_C_SOURCE=200809L

#############################################################################################################
# PUBLIC TARGETS ############################################################################################
#############################################################################################################

build: --prep $(LIST_OBJ)
	cc -shared ${DIR_OBJ}/*.o -o ${DIR_LIB}/libdu.so ${DIR_LIBS}
	ar rcs ${DIR_LIB}/libdu.a ${DIR_OBJ}/*.o

install:
	mkdir -p ${DEST_HEADERS}
	cp $(DIR_INC)/* $(DEST_HEADERS)/
	cp $(DIR_LIB)/* $(DEST_LIBS)/

clean:
	rm -rf ${DEST_BUILD}

#############################################################################################################
# PRIVATE TARGETS ###########################################################################################
#############################################################################################################

--prep:
	mkdir -p $(DIR_INC)
	mkdir -p $(DIR_LIB)
	mkdir -p $(DIR_OBJ)
	cp src/*.h $(DIR_INC)

$(DIR_OBJ)/%.o: $(DIR_SRC)/%.c $(LIST_INC)
	$(CC) -c $(FLAGS) -c $< -o $@
